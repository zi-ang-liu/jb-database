# 正規化理論

| 正規刑     | Abbreviation | 定義                                                                    |
| ---------- | ------------ | ----------------------------------------------------------------------- |
| 第一正規形 | 1NF          | ドメインが**シンプル**であること                                        |
| 第二正規形 | 2NF          | 1NFを満たし、全ての非キー属性が各候補キーに**完全関数従属**していること |
| 第三正規形 | 3NF          | 2NFを満たし、全ての非キー属性が各候補キーに**推移的関数従属**しないこと |

## 第一正規形 (1NF)

リレーショナルデータベースを設計するには、一般的に実体関連モデルを用いてER図を作成し、そこからリレーションスキーマを導出する。得られたリレーションスキーマは、全て第一正規刑を満たさなければならない。

````{prf:definition}
:label: definition-1NF
:nonumber:
リレーションスキーマ$\boldsymbol{R}(A_1, A_2, \ldots, A_n)$が**第1正規形**（1NF, first normal form）であるとは，任意のドメインが**シンプル**であることをいう．

シンプルはドメインの元が**原子的**（atomic），即ち**分解不可能**（nondecomposable）な値であることを指す．
````

## 更新時異状

しかし、リレーションスキーマが第1正規形を満たしていても、様々な**更新時異状**（update anomaly）が発生する可能性がある。

例えば、以下のようなリレーションを考える。「学籍番号」と「科目番号」を主キーとする。

| 学籍番号 | 科目番号 | 科目名         | 成績 |
| -------- | -------- | -------------- | ---- |
| 2501     | CS101    | 計算機科学     | 92   |
| 2501     | CS102    | プログラミング | 85   |
| 2502     | CS101    | 計算機科学     | 88   |
| 2502     | CS103    | データベース   | 90   |

- **挿入時異状**: 新しい科目「CS104 人工知能概論」を追加したいが、まだ受講者がいないため、挿入できない。
- **削除時異状**: (2502, CS103, データベース, 90)を削除すると、科目「データベース」の情報が失われる。
- **修正時異状**: 科目名「計算機科学」を「コンピュータサイエンス」に変更したいが、複数の行を修正する必要がある。

## 第二正規形 (2NF)


### 関数従属性

````{prf:definition}
:label: functonal-dependency
:nonumber:

リレーションスキーマ$\boldsymbol{R}(X, Y, Z)$において、**関数従属性**（functional dependency）$X \to Y$が存在するとは、$\boldsymbol{R}$の任意のインスタンス$R$に対して、次の条件が成り立つことをいう。

$$
\forall r_1, r_2 \in R, \quad (r_1[X] = r_2[X] \implies r_1[Y] = r_2[Y])
$$

````

つまり、$X \to Y$が存在する場合、任意のインスタンス$r_1$と$r_2$において、$X$の値が同じならば、$Y$の値も同じであることを意味する。

````{prf:example}
:nonumber:
成績(<u>学籍番号</u>, <u>科目番号</u>, 科目名, 成績)において、学籍番号と科目番号の組み合わせが主キーであるとする。次のような関数従属性が存在する。

1. $\{学籍番号, 科目番号\} \to \{成績\}$
2. $\{科目番号\} \to \{科目名\}$
````

````{prf:example}
:nonumber:

下記のリレーションスキーマでは、関数従属性を定義してみよう。

1. 注文(<u>顧客ID</u>, <u>商品番号</u>, 商品名, 単価, 数量, 金額)
2. 成績(<u>学籍番号</u>, <u>科目番号</u>, 科目名, 成績, 単位数, 担当教員, 判定)
3. 供給(<u>供給者ID</u>, <u>商品番号</u>, 在庫数, 所在地, 供給者名, 電話番号)

````

### 完全関数従属性

<!-- ````{prf:definition}     -->

